<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curso de Liderazgo</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f4f4f4;}
    .container { max-width: 900px; margin: auto; padding: 20px;}
    header { text-align: center; margin-bottom: 20px;}
    .module { margin-bottom: 20px; background:#fff; padding: 10px; border-radius:5px; }
    .module-header { cursor:pointer; display:flex; justify-content:space-between; padding:5px; background:#eee; border-radius:5px;}
    .activities { display:block; margin-top:10px; }
    .activity { margin-bottom:10px; }
    .progress-container { margin:20px 0; }
    .progress-bar { width:100%; height:20px; background:#ddd; border-radius:10px; overflow:hidden;}
    .progress-fill { height:100%; width:0%; background:#2196F3; text-align:center; color:white; line-height:20px;}
    #course-screen { display:none; }
    button { cursor:pointer; }
    #download-btn { display:none; margin-top:20px; padding:10px 20px; font-size:16px; }
    
    /* Estilos para el botón Comenzar */
    .start-button-container { text-align: center; margin: 25px 0; }
    .start-btn {
        background: #27ae60; color: white; border: none; padding: 15px 35px;
        font-size: 18px; border-radius: 30px; cursor: pointer; transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }
    .start-btn:hover {
        background: #219653; transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
    }
    .start-btn i { margin-right: 10px; }
</style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo"><i class="fas fa-graduation-cap"></i> Liderazgo</div>
        <p>Capacitación en línea</p>
    </header>

    <div class="app-content">
        <!-- Pantalla de login -->
        <div id="login-screen">
            <h2>Acceso al Curso</h2>
            <div class="login-form">
                <div class="form-group">
                    <label for="fullname">Nombre Completo</label>
                    <input type="text" id="fullname" placeholder="Ej: Juan Pérez">
                </div>
                <div class="form-group">
                    <label for="company-id">MEP</label>
                    <input type="text" id="company-id" placeholder="Ej: ABC123">
                </div>
                <div class="button-group">
                    <button id="login-btn"><i class="fas fa-sign-in-alt"></i> Acceder al Curso</button>
                </div>
                <div id="loading" style="display:none;">Enviando datos...</div>
                <div id="success-message" style="display:none;">Datos enviados correctamente</div>
                <div id="error-message" style="display:none;">Hubo un error al enviar los datos. Se guardará localmente.</div>
            </div>
        </div>

        <!-- Pantalla del curso -->
        <div id="course-screen">
            <div class="welcome-header">
                <div class="user-info"><i class="fas fa-user-check"></i> Bienvenido, <span id="user-name"></span></div>
                <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
            </div>

            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress-fill">0%</div></div>
            </div>
            
            <!-- Botón Comenzar -->
            <div class="start-button-container">
                <button class="start-btn" id="start-button">
                    <i class="fas fa-play-circle"></i> Comenzar
                </button>
            </div>

            <div class="course-content">

                <!-- Examen Diagnóstico -->
                <div class="module">
                    <div class="module-header" onclick="toggleModule(0)">
                        <div class="module-title"><i class="fas fa-file-alt"></i> Examen Diagnóstico</div>
                        <div class="module-status" id="module-0-status">No iniciado</div>
                    </div>
                    <div class="activities">
                        <div class="activity">
                            <button onclick="openActivity('activity-0-1','EXAMEN/Examen-Diagnostico.html')"><i class="fas fa-clipboard-list"></i> Realizar Examen Diagnóstico</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-0-1" data-module="0" disabled>
                        </div>
                    </div>
                </div>

                <!-- Módulo 1 -->
                <div class="module">
                    <div class="module-header" onclick="toggleModule(1)">
                        <div class="module-title"><i class="fas fa-play-circle"></i> Módulo 1</div>
                        <div class="module-status" id="module-1-status">No iniciado</div>
                    </div>
                    <div class="activities">
                        <div class="activity">
                            <button onclick="openActivity('activity-1-0','INTRODUCCION/modulo1.html')"><i class="fas fa-book-open"></i> Introducción</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-1-0" data-module="1" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-1-1','MODULO1/1/Tema1.html')"><i class="fas fa-book"></i> Tema 1.- ¿Qué es el liderazgo?</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-1-1" data-module="1" disabled>
                        </div>
                        <!-- ACTIVIDAD SOPA DE LETRAS -->
                        <div class="activity">
                            <button onclick="openActivity('sopa-de-letras','MODULO1/1/sopa.html')"><i class="fas fa-puzzle-piece"></i> Actividad 1</button>
                            <input type="checkbox" class="activity-checkbox" id="sopa-de-letras" data-module="1" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-1-2','MODULO1/2/Tema2.html')"><i class="fas fa-book"></i> Tema 2.- ¿Quién es un líder?</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-1-2" data-module="1" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-1-3','MODULO1/3/Tema3.html')"><i class="fas fa-book"></i> Tema 3.- El líder con enfoque humanista</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-1-3" data-module="1" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('conclusion','MODULO1/conclusion.html')"><i class="fas fa-book"></i> Conclusión</button>
                            <input type="checkbox" class="activity-checkbox" id="conclusion" data-module="1" disabled>
                        </div>
                    </div>
                </div>

                <!-- Módulo 2 -->
                <div class="module">
                    <div class="module-header" onclick="toggleModule(2)">
                        <div class="module-title"><i class="fas fa-chalkboard-teacher"></i> Módulo 2</div>
                        <div class="module-status" id="module-2-status">No iniciado</div>
                    </div>
                    <div class="activities">
                        <div class="activity">
                            <button onclick="openActivity('activity-2-0','INTRODUCCION/modulo2.html')"><i class="fas fa-book-open"></i> Introducción</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-2-0" data-module="2" disabled>
                        </div>
                        <!-- ACTIVIDAD -->
                        <div class="activity">
                            <button onclick="openActivity('crucigrama','MODULO2/1/crucigrama.html')"><i class="fas fa-puzzle-piece"></i> Actividad 2</button>
                            <input type="checkbox" class="activity-checkbox" id="crucigrama" data-module="2" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-2-1','MODULO2/1/tema1.html')"><i class="fas fa-users"></i> Tema 1.-  Persona</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-2-1" data-module="2" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-2-2','MODULO2/2/tema2.html')"><i class="fas fa-lightbulb"></i> Tema 2.-¿Quién soy?</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-2-2" data-module="2" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-2-3','MODULO2/3/tema3.html')"><i class="fas fa-comments"></i> Tema 3.- Descubrimiento personal en el trabajo</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-2-3" data-module="2" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('conclusion2','MODULO2/conclusion.html')"><i class="fas fa-book"></i> Conclusión</button>
                            <input type="checkbox" class="activity-checkbox" id="conclusion2" data-module="2" disabled>
                        </div>
                    </div>
                </div>

                <!-- Módulo 3 -->
                <div class="module">
                    <div class="module-header" onclick="toggleModule(3)">
                        <div class="module-title"><i class="fas fa-briefcase"></i> Módulo 3: Liderazgo en la Organización</div>
                        <div class="module-status" id="module-3-status">No iniciado</div>
                    </div>
                    <div class="activities">
                        <div class="activity">
                            <button onclick="openActivity('activity-3-0','INTRODUCCION/modulo3.html')"><i class="fas fa-book-open"></i> Introducción</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-3-0" data-module="3" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-3-1','MODULO3/1/tema1.html')"><i class="fas fa-project-diagram"></i> Tema 1.- ¿Qué función realiza el líder humanista en la organización?</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-3-1" data-module="3" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-3-2','MODULO3/2/tema2.html')"><i class="fas fa-users-cog"></i> Tema 2.- El liderazgo humanista y las relaciones humanas.</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-3-2" data-module="3" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-3-3','MODULO3/3/tema3.html')"><i class="fas fa-award"></i> Tema 3.- El liderazgo humanista y el trabajo en equipo.</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-3-3" data-module="3" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('activity-3-4','MODULO3/4/tema4.html')"><i class="fas fa-users-cog"></i> Tema 4.- Importancia del liderazgo humanista en la Nueva Cultura Laboral.</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-3-4" data-module="3" disabled>
                        </div>
                        <div class="activity">
                            <button onclick="openActivity('conclusion3','MODULO2/conclusion.html')"><i class="fas fa-book"></i> Conclusión</button>
                            <input type="checkbox" class="activity-checkbox" id="conclusion3" data-module="3" disabled>
                        </div>
                    </div>
                </div>

                <!-- Examen Final -->
                <div class="module">
                    <div class="module-header" onclick="toggleModule(4)">
                        <div class="module-title"><i class="fas fa-file-signature"></i> Examen Final</div>
                        <div class="module-status" id="module-4-status">No iniciado</div>
                    </div>
                    <div class="activities">
                        <div class="activity">
                            <button onclick="openActivity('activity-4-1','EXAMEN/Examen-Final.html')"><i class="fas fa-clipboard-check"></i> Realizar Examen Final</button>
                            <input type="checkbox" class="activity-checkbox" id="activity-4-1" data-module="4" disabled>
                        </div>
                    </div>
                </div>

                <button id="download-btn"><i class="fas fa-download"></i> Descargar Ficha</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 IE-Todos los derechos reservados</p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const loginScreen = document.getElementById('login-screen');
    const courseScreen = document.getElementById('course-screen');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const fullnameInput = document.getElementById('fullname');
    const companyIdInput = document.getElementById('company-id');
    const userNameSpan = document.getElementById('user-name');
    const checkboxes = document.querySelectorAll('.activity-checkbox');
    const downloadBtn = document.getElementById('download-btn');
    const loadingIndicator = document.getElementById('loading');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');
    const startButton = document.getElementById('start-button');

    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbxq7PCh8_NcRGcAIIQhkDGN8WQIhiG06mHMxA73-iq0Q0etxNFpjER6QLHyDTjiwvi2/exec';

    // ==========================
    // Convertir a MAYÚSCULAS en tiempo real
    // ==========================
    fullnameInput.addEventListener("input", () => { fullnameInput.value = fullnameInput.value.toUpperCase(); });
    companyIdInput.addEventListener("input", () => { companyIdInput.value = companyIdInput.value.toUpperCase(); });

    // Revisar sesión activa
    checkExistingSession();

    loginBtn.addEventListener('click', handleLogin);
    logoutBtn.addEventListener('click', handleLogout);
    startButton.addEventListener('click', handleStartButton);

    checkboxes.forEach(cb => {
        cb.addEventListener("change", () => {
            updateLabelStyle(cb);
            updateProgress();
            saveProgress();
            unlockNextActivity(cb);
        });
    });

    function handleLogin() {
        const fullname = fullnameInput.value.trim().toUpperCase();
        const companyId = companyIdInput.value.trim().toUpperCase();
        if (!fullname || !companyId) { alert('Completa todos los campos'); return; }

        const user = { fullname, companyId };
        localStorage.setItem('currentUser', JSON.stringify(user));

        loadingIndicator.style.display = 'block';
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';

        sendToGoogleSheets(fullname, companyId)
        .then(() => {
            loadingIndicator.style.display = 'none';
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
                resetCheckboxes();
                showCourseScreen(user);
                lockAllActivities();
                loadProgress();
                unlockCompletedActivities(); 
                unlockNextAvailableActivity();
            },1500);
        })
        .catch(() => {
            loadingIndicator.style.display = 'none';
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
                resetCheckboxes();
                showCourseScreen(user);
                lockAllActivities();
                loadProgress();
                unlockCompletedActivities(); 
                unlockNextAvailableActivity();
            },3000);
        });
    }

    function handleStartButton() {
        const firstActivity = document.getElementById('activity-0-1');
        window.open('EXAMEN/Examen-Diagnostico.html', '_blank');
    }

    async function sendToGoogleSheets(name, mep){
        const data = { nombre:name, mep:mep, fecha:new Date().toLocaleString(), origen:'CursoLiderazgo' };
        const params = new URLSearchParams(data);
        await fetch(googleScriptURL,{ method:'POST', mode:'no-cors', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body:params});
    }

    function handleLogout() {
        localStorage.removeItem('currentUser');
        courseScreen.style.display = 'none';
        loginScreen.style.display = 'block';
        fullnameInput.value='';
        companyIdInput.value='';
    }

    function checkExistingSession() {
        const currentUser = localStorage.getItem('currentUser');
        if(currentUser){
            showCourseScreen(JSON.parse(currentUser));
            loadProgress();
            lockAllActivities();
            unlockCompletedActivities(); 
            unlockNextAvailableActivity();
        }
    }

    function showCourseScreen(user){
        loginScreen.style.display='none';
        courseScreen.style.display='block';
        userNameSpan.textContent=user.fullname;
    }

    function resetCheckboxes(){
        checkboxes.forEach(cb => { cb.checked=false; updateLabelStyle(cb); });
        updateProgress();
    }

    function updateLabelStyle(checkbox){
        const label=document.querySelector(`label[for="${checkbox.id}"]`);
        if(label) label.classList.toggle('completed', checkbox.checked);
    }

    function updateProgress(){
        const allCbs = document.querySelectorAll(".activity-checkbox");
        const allChecked = document.querySelectorAll(".activity-checkbox:checked");
        const progressPercent = (allChecked.length / allCbs.length) * 100;
        const progressFill = document.getElementById("progress-fill");
        if(progressFill) progressFill.style.width = progressPercent + "%";
        progressFill.textContent = Math.round(progressPercent)+"%";
        checkCompletion();
    }

    function saveProgress(){
        const currentUser=JSON.parse(localStorage.getItem('currentUser'));
        if(!currentUser) return;
        const progressData={};
        checkboxes.forEach(cb => progressData[cb.id]=cb.checked);
        localStorage.setItem(`progress_${currentUser.companyId}_${currentUser.fullname}`,JSON.stringify(progressData));
    }

    function loadProgress(){
        const currentUser=JSON.parse(localStorage.getItem('currentUser'));
        if(!currentUser) return;
        const saved=localStorage.getItem(`progress_${currentUser.companyId}_${currentUser.fullname}`);
        if(saved){
            const data=JSON.parse(saved);
            Object.keys(data).forEach(id=>{
                const cb=document.getElementById(id);
                if(cb){ cb.checked=data[id]; updateLabelStyle(cb); }
            });
        }
        updateProgress();
    }

    function lockAllActivities(){
        document.querySelectorAll('.module .activity button').forEach(btn=>{ btn.disabled = true; });
    }

    function unlockNextActivity(checkbox){
        const activities = Array.from(document.querySelectorAll('.activity-checkbox'));
        const index = activities.indexOf(checkbox);
        if(index > -1 && checkbox.checked){
            const next = activities[index+1];
            if(next){
                const btn = next.closest('.activity').querySelector('button');
                if(btn) btn.disabled = false;
            }
        }
    }

    function unlockNextAvailableActivity(){
        const activities = Array.from(document.querySelectorAll('.activity-checkbox'));
        for(const cb of activities){
            const btn = cb.closest('.activity').querySelector('button');
            if(!cb.checked){
                if(btn) btn.disabled = false;
                break;
            }
        }
    }

    // Desbloquear botones de actividades ya completadas
    function unlockCompletedActivities(){
        const activities = Array.from(document.querySelectorAll('.activity-checkbox'));
        activities.forEach(cb => {
            if(cb.checked){
                const btn = cb.closest('.activity').querySelector('button');
                if(btn) btn.disabled = false;
            }
        });
    }

    window.openActivity=function(activityId,url){
        const cb=document.getElementById(activityId);

        const excepciones=["activity-0-1","sopa-de-letras","crucigrama","activity-4-1" ]
        if(cb && !cb.checked && !excepciones.includes(activityId)){ 
        cb.checked = true; 
        updateLabelStyle(cb); 
        updateProgress(); 
        saveProgress(); 
        unlockNextActivity(cb);
    }

        window.open(url,'_blank');
    }

    function checkCompletion(){
        const allCbs=document.querySelectorAll(".activity-checkbox");
        const allChecked=document.querySelectorAll(".activity-checkbox:checked");
        const progressPercent=(allChecked.length/allCbs.length)*100;
        downloadBtn.style.display = (progressPercent === 100)?'inline-block':'none';
    }

  // ==========================
// DESCARGA DE FICHA
// ==========================
downloadBtn.addEventListener('click', function(){
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if(!currentUser) return;

    const canvas = document.createElement('canvas');
    canvas.width = 1000;
    canvas.height = 700;
    const ctx = canvas.getContext('2d');

    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, "#f0f8ff");
    gradient.addColorStop(1, "#ffffff");
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "#2196F3";
    ctx.lineWidth = 8;
    ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

    ctx.fillStyle = "#333";
    ctx.font = "bold 40px Georgia";
    ctx.textAlign = "center";
    ctx.fillText("Comprobante de Finalización del Curso", canvas.width/2, 180); 

    ctx.font = "28px Arial";
    ctx.fillStyle = "#000";
    ctx.fillText(`Se otorga el presente comprobante a`, canvas.width/2, 260); 

    ctx.font = "bold 36px 'Times New Roman'";
    ctx.fillStyle = "#2196F3";
    ctx.fillText(currentUser.fullname.toUpperCase(), canvas.width/2, 360); 

    ctx.font = "24px Arial";
    ctx.fillStyle = "#333";
    ctx.fillText(`MEP: ${currentUser.companyId}`, canvas.width/2, 450); 
    ctx.fillText(`Finalizado el: ${new Date().toLocaleDateString()}`, canvas.width/2, 530); 

    const link = document.createElement('a');
    link.download = `Comprobante_${currentUser.fullname.toUpperCase()}.jpg`;
    link.href = canvas.toDataURL('image/jpeg');
    link.click();

    localStorage.removeItem(`progress_${currentUser.companyId}_${currentUser.fullname}`);
    localStorage.removeItem('currentUser');
    courseScreen.style.display = 'none';
    loginScreen.style.display = 'block';
    fullnameInput.value = '';
    companyIdInput.value = '';
    });
});
</script>
<script src="Temporizador.js"></script>
</body>
</html>