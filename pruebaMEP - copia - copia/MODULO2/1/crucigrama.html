<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crucigrama</title>
    <style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        color: #333;
        overflow-x: hidden;
    }
    
    .container {
        width: 100%;
        max-width: 1000px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    
    header {
        text-align: center;
        margin-bottom: 15px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: 100%;
    }
    
    h1 {
        font-size: 22px;
        color: #2c3e50;
        line-height: 1.4;
    }
    
    .game-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 25px;
        width: 100%;
    }
    
    .words-panel {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 250px;
        max-width: 320px;
    }
    
    .words-panel h2 {
        text-align: center;
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #eee;
    }
    
    .word-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .word-item {
        padding: 10px 12px;
        background: #f8f9fa;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
    }
    
    .word-item.found {
        background: #4CAF50;
        color: white;
        text-decoration: line-through;
    }
    
    .board-container {
        background: white;
        padding: 20px 15px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        flex: 2;
        min-width: 300px;
        max-width: 100%;
        overflow: hidden;
    }
    
    #board {
        display: grid;
        grid-template-columns: repeat(16, 1fr);
        grid-template-rows: repeat(14, 1fr);
        gap: 2px;
        width: 100%;
        height: auto;
        max-width: 100%;
        margin: 0 auto;
    }
    
    .cell {
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #e9ecef;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        transition: all 0.2s ease;
        font-size: 20px;
    }
    
    .cell.selected {
        background: #a5d8ff;
    }
    
    .cell.found {
        background: #4CAF50;
        color: white;
        transform: scale(1.05);
    }
    
    .controls {
        display: flex;
        gap: 15px;
        margin-top: 10px;
    }
    
    button {
        padding: 12px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    button:hover {
        background: #2980b9;
        transform: translateY(-2px);
    }
    
    #message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 30px 50px;
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        text-align: center;
        z-index: 1000;
        display: none;
        animation: popIn 0.5s ease-out;
    }
    
    /* Estilos para la navegación */
        .page-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        
        .nav-btn {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            background-color: #2c3e50;
        }
        
        .nav-btn.prev {
            background-color: #7f8c8d;
        }
        
        .nav-btn.prev:hover {
            background-color: #34495e;
        }
        #next-button {
    display: none; /* Oculto al inicio */
        }

        /* Indicador de progreso */
        .progress-indicator {
            text-align: center;
            padding: 10px;
            background-color: #e8f4f8;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .progress-indicator.visible {
            display: block;
        }

    @keyframes popIn {
        0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    #message h2 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 24px;
    }
    
    #message p {
        margin-bottom: 20px;
        font-size: 18px;
    }
    
    #message button {
        background: #4CAF50;
    }
    
    /* Responsive design */
    @media (max-width: 900px) {
        .board-container { padding: 15px 10px; }
        .cell { width: 30px; height: 30px; font-size: 18px; }
    }
    
    @media (max-width: 768px) {
        .game-container { flex-direction: column; align-items: center; }
        .words-panel, .board-container { width: 100%; max-width: 100%; }
        .board-container { padding: 15px 5px; }
        #board { grid-template-columns: repeat(16, 1fr); grid-template-rows: repeat(14, 1fr); gap: 1px; }
        .cell { width: 22px; height: 22px; font-size: 14px; }
        h1 { font-size: 18px; }
    }
    
    @media (max-width: 480px) {
        body { padding: 15px 10px; }
        .container { gap: 15px; }
        header { padding: 15px 10px; }
        h1 { font-size: 16px; }
        .game-container { gap: 15px; }
        .board-container { padding: 12px 5px; }
        #board { grid-template-columns: repeat(16, 1fr); grid-template-rows: repeat(14, 1fr); gap: 1px; }
        .cell { width: 18px; height: 18px; font-size: 12px; }
        .words-panel { padding: 15px; }
        .word-item { padding: 8px 10px; font-size: 14px; }
    }
    
    @media (max-width: 360px) {
        .cell { width: 16px; height: 16px; font-size: 11px; }
        .words-panel { padding: 12px; }
        .word-item { padding: 6px 8px; font-size: 13px; }
    }
    
    .instructions {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 14px;
        color: #555;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 600px;
    }
</style>
</head>
<body>
    <div class="container">
        <header>
            <h1>1. Señala en el siguiente cuadro la lista de los diferentes estilos de liderazgo que se encuentran al final de la página.</h1>
        </header>
        
        <div class="game-container">
            <div class="board-container">
                <div id="board"></div>
            </div>
            
            <div class="words-panel">
                <h2>Palabras a buscar</h2>
                <div class="word-list" id="word-list"></div>
            </div>
        </div>
    </div>
    <div id="progress-indicator" style="display:none; color: green; font-weight:bold;">
    ✔ Actividad completada
</div>

    <div id="message">
        <h2>¡Felicidades!</h2>
        <p>Has encontrado todas las palabras.</p>
        <button id="close-message">Cerrar</button>
    </div>

     <div class="page-navigation">
        <button class="nav-btn prev" onclick="goBack()">
            ← Volver al Curso
        </button>
        
        <button class="nav-btn next" id="next-button">
            Siguiente Tema →
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const config = {
                rows: 15,
                cols: 16,
                words: [
                    "DESCENTRALIZADO", "HUMANISTA", "CORRECTIVO", "CENTRALIZADO",
                    "PERSONAL", "SITUACIONAL", "DESPOTICO", "MAQUIAVELICO", "RACIONAL",
                    "FACULTATIVO"
                ]
            };
            
            const board = document.getElementById('board');
            const wordList = document.getElementById('word-list');
            const message = document.getElementById('message');
            const closeMessage = document.getElementById('close-message');
            
            let cells = [];
            let selectedCells = [];
            let foundWords = [];
            let isSelecting = false;
            let startCell = null;
            let direction = null;
            
            const colors = [
                '#4CAF50', '#2196F3', '#9C27B0', '#FF9800', 
                '#E91E63', '#00BCD4', '#8BC34A', '#FF5722', 
                '#009688', '#673AB7'
            ];
            
            function initGame() {
                createWordList();
                createBoard();
                placeWords(); // Aquí garantizamos todas las palabras
                fillEmptyCells();
                renderBoard();
            }
            
            function createWordList() {
                config.words.forEach(word => {
                    const wordElement = document.createElement('div');
                    wordElement.classList.add('word-item');
                    wordElement.id = `word-${word}`;
                    wordElement.textContent = word;
                    wordList.appendChild(wordElement);
                });
            }
            
            function createBoard() {
                board.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;
                board.style.gridTemplateRows = `repeat(${config.rows}, 1fr)`;
                
                for (let r = 0; r < config.rows; r++) {
                    cells[r] = [];
                    for (let c = 0; c < config.cols; c++) {
                        cells[r][c] = { letter: '', element: null, isFound: false };
                    }
                }
            }
            
            // --- FUNCION PLACEWORDS MODIFICADA ---
            function placeWords() {
                const directions = [
                    { dr: 0, dc: 1 },
                    { dr: 1, dc: 0 },
                    { dr: 1, dc: 1 },
                    { dr: 1, dc: -1 }
                ];

                config.words.forEach(word => {
                    let placed = false;
                    while (!placed) {
                        const dir = directions[Math.floor(Math.random() * directions.length)];
                        const startR = Math.floor(Math.random() * config.rows);
                        const startC = Math.floor(Math.random() * config.cols);

                        const endR = startR + dir.dr * (word.length - 1);
                        const endC = startC + dir.dc * (word.length - 1);

                        if (endR < 0 || endR >= config.rows || endC < 0 || endC >= config.cols) continue;

                        let canPlace = true;
                        for (let i = 0; i < word.length; i++) {
                            const r = startR + i * dir.dr;
                            const c = startC + i * dir.dc;
                            if (cells[r][c].letter !== '' && cells[r][c].letter !== word[i]) {
                                canPlace = false;
                                break;
                            }
                        }

                        if (canPlace) {
                            for (let i = 0; i < word.length; i++) {
                                const r = startR + i * dir.dr;
                                const c = startC + i * dir.dc;
                                cells[r][c].letter = word[i];
                            }
                            placed = true;
                        }
                    }
                });
            }

            function fillEmptyCells() {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                for (let r = 0; r < config.rows; r++) {
                    for (let c = 0; c < config.cols; c++) {
                        if (cells[r][c].letter === '') {
                            cells[r][c].letter = letters[Math.floor(Math.random() * letters.length)];
                        }
                    }
                }
            }

            function renderBoard() {
                board.innerHTML = '';
                for (let r = 0; r < config.rows; r++) {
                    for (let c = 0; c < config.cols; c++) {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        cell.textContent = cells[r][c].letter;
                        cell.dataset.row = r;
                        cell.dataset.col = c;

                        cell.addEventListener('mousedown', handleMouseDown);
                        cell.addEventListener('mouseenter', handleMouseEnter);
                        cell.addEventListener('mouseup', handleMouseUp);

                        cell.addEventListener('touchstart', handleTouchStart);
                        cell.addEventListener('touchmove', handleTouchMove);
                        cell.addEventListener('touchend', handleTouchEnd);

                        cells[r][c].element = cell;
                        board.appendChild(cell);
                    }
                }
            }

            function handleMouseDown(e) { e.preventDefault(); startSelection(e.target); }
            function handleMouseEnter(e) { if(isSelecting) continueSelection(e.target); }
            function handleMouseUp() { endSelection(); }

            function handleTouchStart(e) { 
                e.preventDefault();
                const touch = e.touches[0];
                const cell = document.elementFromPoint(touch.clientX, touch.clientY);
                if(cell && cell.classList.contains('cell')) startSelection(cell);
            }
            function handleTouchMove(e) {
                e.preventDefault();
                if(!isSelecting) return;
                const touch = e.touches[0];
                const cell = document.elementFromPoint(touch.clientX, touch.clientY);
                if(cell && cell.classList.contains('cell')) continueSelection(cell);
            }
            function handleTouchEnd() { endSelection(); }

            function startSelection(cell) {
                isSelecting = true;
                clearSelection();
                startCell = cell;
                selectedCells = [cell];
                direction = null;
                cell.classList.add('selected');
            }

            function continueSelection(cell) {
                if(!isSelecting || selectedCells.includes(cell)) return;
                const startRow = parseInt(startCell.dataset.row);
                const startCol = parseInt(startCell.dataset.col);
                const currentRow = parseInt(cell.dataset.row);
                const currentCol = parseInt(cell.dataset.col);

                if(!direction){
                    const rowDiff = currentRow - startRow;
                    const colDiff = currentCol - startCol;
                    if(rowDiff===0 && colDiff!==0){direction={dr:0,dc:Math.sign(colDiff)};}
                    else if(rowDiff!==0 && colDiff===0){direction={dr:Math.sign(rowDiff),dc:0};}
                    else if(Math.abs(rowDiff)===Math.abs(colDiff)){direction={dr:Math.sign(rowDiff),dc:Math.sign(colDiff)};}
                    else return;
                }

                const expectedRow = parseInt(selectedCells[selectedCells.length-1].dataset.row) + direction.dr;
                const expectedCol = parseInt(selectedCells[selectedCells.length-1].dataset.col) + direction.dc;

                if(currentRow===expectedRow && currentCol===expectedCol){
                    selectedCells.push(cell);
                    cell.classList.add('selected');
                }
            }

            function endSelection(){
                isSelecting=false;
                if(selectedCells.length<2){clearSelection(); return;}

                const selectedWord = selectedCells.map(cell=>cell.textContent).join('');
                const selectedWordReverse = [...selectedCells].reverse().map(cell=>cell.textContent).join('');

                let foundWord = null;
                if(config.words.includes(selectedWord) && !foundWords.includes(selectedWord)){foundWord=selectedWord;}
                else if(config.words.includes(selectedWordReverse) && !foundWords.includes(selectedWordReverse)){
                    foundWord=selectedWordReverse;
                    selectedCells.reverse();
                }

                if(foundWord){
                    foundWords.push(foundWord);
                    const colorIndex = config.words.indexOf(foundWord) % colors.length;
                    selectedCells.forEach(cell=>{cell.classList.remove('selected');cell.classList.add('found');cell.style.backgroundColor=colors[colorIndex];});
                    const wordElement = document.getElementById(`word-${foundWord}`);
                    wordElement.classList.add('found'); wordElement.style.backgroundColor=colors[colorIndex];

                    if (foundWords.length === config.words.length) {
                        setTimeout(() => {
                            message.style.display = 'block';
                            document.getElementById('next-button').style.display = 'inline-block'; // mostrar botón
                        }, 500);
                    }

                } else { clearSelection(); }
            }

            function clearSelection(){
                selectedCells.forEach(cell=>{if(!cell.classList.contains('found')) cell.classList.remove('selected');});
                selectedCells=[];
                direction=null;
            }

            closeMessage.addEventListener('click', ()=>{ message.style.display='none'; });

            initGame();
        });
    </script>
    <script>
        // ==========================
        // SINCRONIZACIÓN
        // ==========================
        
        // ID de la actividad actual (debe coincidir con el ID en la página principal)
        const CURRENT_ACTIVITY_ID = 'crucigrama';
        
        // Función para marcar la actividad como completada
        function markActivityCompleted() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return false;
            
            // Obtener el progreso actual del usuario
            const progressKey = `progress_${currentUser.companyId}_${currentUser.fullname}`;
            const savedProgress = localStorage.getItem(progressKey);
            let progressData = savedProgress ? JSON.parse(savedProgress) : {};
            
            // Marcar esta actividad como completada
            progressData[CURRENT_ACTIVITY_ID] = true;
            
            // Guardar en localStorage
            localStorage.setItem(progressKey, JSON.stringify(progressData));
            
            // Disparar evento para sincronizar otras pestañas
            window.dispatchEvent(new Event('storage'));
            
            // Mostrar indicador de progreso
            document.getElementById('progress-indicator').classList.add('visible');
            
            return true;
        }
        
        // Función para verificar si la actividad ya está completada
        function checkActivityStatus() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return false;
            
            const progressKey = `progress_${currentUser.companyId}_${currentUser.fullname}`;
            const savedProgress = localStorage.getItem(progressKey);
            
            if (savedProgress) {
                const progressData = JSON.parse(savedProgress);
                if (progressData[CURRENT_ACTIVITY_ID]) {
                    document.getElementById('progress-indicator').classList.add('visible');
                    return true;
                }
            }
            
            return false;
        }
        
        // Función para navegar al siguiente tema
        function goNext() {
            console.log('Función goNext() ejecutada');
            
            // Primero marcar como completado si no lo está
            if (!checkActivityStatus()) {
                markActivityCompleted();
            }
            
            // Navegar al Tema 2
            window.location.href = '../2/Tema2.html';
        }
        
        // Función para volver al curso
        function goBack() {
            window.location.href = '../../index.html';
        }
        
        // Cuando la página carga, verificar el estado de la actividad
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Página cargada');
            
            // Verificar si hay un usuario logueado
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (currentUser) {
                console.log('Usuario encontrado:', currentUser.fullname);
                
                // Si la actividad no está marcada como completada, marcarla
                if (!checkActivityStatus()) {
                    markActivityCompleted();
                }
                
                // Agregar event listener al botón de siguiente
                document.getElementById('next-button').addEventListener('click', goNext);
                
            } else {
                console.log('No hay usuario logueado');
                
                // Si no hay usuario, ocultar los botones de navegación
                document.querySelector('.page-navigation').style.display = 'none';
                alert('Por favor, inicia sesión en el curso primero.');
            }
        });
        
        // Escuchar eventos de storage para actualizaciones desde otras pestañas
        window.addEventListener('storage', function(e) {
            if (e.key && e.key.startsWith('progress_')) {
                checkActivityStatus();
            }
        });
    </script>
</body>
</html>
